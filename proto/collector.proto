syntax = "proto3";
package collector;

// Control plane service for managing notifications between collectors and frontend
service ControlPlane {
  // Stream notifications from collector to control plane and receive commands from control plane
  rpc Notifications (stream CollectorMessage) returns (stream ControlPlaneMessage);
}

// Messages sent from collector to control plane
message CollectorMessage {
  oneof message {
    NewNotification new_notification = 1;
    NotificationClosed notification_closed = 2;
  }
}

// Messages sent from control plane to collector
message ControlPlaneMessage {
  oneof message {
    ActionInvoked action_invoked = 1;
    NotificationClosed notification_closed = 2;
  }
}

// New notification received from DBus
message NewNotification {
  uint32 id = 1;
  string app_name = 2;
  optional string app_icon = 3;
  string summary = 4;
  string body = 5;
  int32 timeout = 6;
  repeated Action actions = 7;
  NotificationHints hints = 8;
}

// Action definition
message Action {
  string key = 1;
  string label = 2;
}

// Notification hints
message NotificationHints {
  bool action_icons = 1;
  optional string category = 2;
  optional int32 value = 3;
  optional string desktop_entry = 4;
  bool resident = 5;
  optional string sound_file = 6;
  optional string sound_name = 7;
  bool suppress_sound = 8;
  bool transient = 9;
  int32 x = 10;
  optional int32 y = 11;
  Urgency urgency = 12;
  optional Image image = 13;
}

// Urgency level
enum Urgency {
  URGENCY_LOW = 0;
  URGENCY_NORMAL = 1;
  URGENCY_CRITICAL = 2;
}

// Image data
message Image {
  oneof image {
    string name = 1;
    string file_path = 2;
    ImageData data = 3;
  }
}

// Image data structure
message ImageData {
  uint32 width = 1;
  uint32 height = 2;
  int32 rowstride = 3;
  bool has_alpha = 4;
  int32 bits_per_sample = 5;
  int32 channels = 6;
  bytes data = 7;
}

// Notification closed event
message NotificationClosed {
  uint32 id = 1;
  CloseReason reason = 2;
}

// Close reason
enum CloseReason {
  REASON_EXPIRED = 0;
  REASON_DISMISSED_BY_USER = 1;
  REASON_CLOSE_NOTIFICATION_CALL = 2;
  REASON_UNKNOWN = 3;
}

// Action invoked command from control plane
message ActionInvoked {
  uint32 id = 1;
  string action_key = 2;
  string token = 3;
}

