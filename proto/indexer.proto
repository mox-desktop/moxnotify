syntax = "proto3";
package indexer;

// Control plane service for sending notifications to indexers
// Indexers connect as clients and receive notifications via streaming
service ControlPlaneIndexer {
  // Stream notifications from control plane to indexer
  rpc StreamNotifications (IndexerSubscribeRequest) returns (stream IndexerNotificationMessage);
}

// Request from indexer to subscribe to notifications
message IndexerSubscribeRequest {
  // Optional: indexer can specify what it wants to receive
  // Empty for now, can be extended later
}

// Notification message sent from control plane to indexer
message IndexerNotificationMessage {
  NewNotification notification = 1;
}

// New notification to be indexed
message NewNotification {
  uint32 id = 1;
  string app_name = 2;
  optional string app_icon = 3;
  string summary = 4;
  string body = 5;
  int32 timeout = 6;
  repeated Action actions = 7;
  NotificationHints hints = 8;
}

// Action definition
message Action {
  string key = 1;
  string label = 2;
}

// Notification hints
message NotificationHints {
  bool action_icons = 1;
  optional string category = 2;
  optional int32 value = 3;
  optional string desktop_entry = 4;
  bool resident = 5;
  optional string sound_file = 6;
  optional string sound_name = 7;
  bool suppress_sound = 8;
  bool transient = 9;
  int32 x = 10;
  optional int32 y = 11;
  Urgency urgency = 12;
  optional Image image = 13;
}

// Urgency level
enum Urgency {
  URGENCY_LOW = 0;
  URGENCY_NORMAL = 1;
  URGENCY_CRITICAL = 2;
}

// Image data
message Image {
  oneof image {
    string name = 1;
    string file_path = 2;
    ImageData data = 3;
  }
}

// Image data structure
message ImageData {
  uint32 width = 1;
  uint32 height = 2;
  int32 rowstride = 3;
  bool has_alpha = 4;
  int32 bits_per_sample = 5;
  int32 channels = 6;
  bytes data = 7;
}

